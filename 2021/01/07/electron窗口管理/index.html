<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>electron窗口管理 | 王美的个人博客</title><meta name="description" content="窗口主窗口隐藏和恢复主窗口为什么需要 主窗口?一个应用存在着许多的窗口，需要一个窗口作为 __主窗口__，如果该窗口关闭，则意味着整个应用被关闭。 场景：在应用只有一个页面的时，用户点击关闭按钮，不想让整个应用关闭，而是隐藏；例如：其他的app，像微信，QQ等桌面端。   主进程代码示例，完整代码在本应用的app&#x2F;browser-window&#x2F;index.ts处 12345678910111213"><meta name="keywords" content="electron"><meta name="author" content="王美"><meta name="copyright" content="王美"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://hard-workingrookie.github.io/2021/01/07/electron%E7%AA%97%E5%8F%A3%E7%AE%A1%E7%90%86/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="electron窗口管理"><meta property="og:url" content="https://hard-workingrookie.github.io/2021/01/07/electron%E7%AA%97%E5%8F%A3%E7%AE%A1%E7%90%86/"><meta property="og:site_name" content="王美的个人博客"><meta property="og:description" content="窗口主窗口隐藏和恢复主窗口为什么需要 主窗口?一个应用存在着许多的窗口，需要一个窗口作为 __主窗口__，如果该窗口关闭，则意味着整个应用被关闭。 场景：在应用只有一个页面的时，用户点击关闭按钮，不想让整个应用关闭，而是隐藏；例如：其他的app，像微信，QQ等桌面端。   主进程代码示例，完整代码在本应用的app&#x2F;browser-window&#x2F;index.ts处 12345678910111213"><meta property="og:image" content="http://tvshow.date/images/1504170750981724.jpg"><meta property="article:published_time" content="2021-01-07T07:32:15.000Z"><meta property="article:modified_time" content="2021-03-09T14:07:44.053Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime: '',
  last_push_date: {"zeroDay":"今天","suffix":"天前"},
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
      const now = new Date()
      const expiryDay = ttl * 86400000
      const item = {
        value: value,
        expiry: now.getTime() + expiryDay,
      }
      localStorage.setItem(key, JSON.stringify(item))
    },
  
  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2021-03-09 22:07:44'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="王美的个人博客" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">23</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">21</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">13</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/Share/"><i class="fa-fw fas fa-heart"></i><span> Share</span></a></div><div class="menus_item"><a class="site-page" href="/Diary/"><i class="fa-fw fas fa-paint-brush"></i><span> Diary</span></a></div><div class="menus_item"><a class="site-page" href="/About/"><i class="fa-fw fas fa-info"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3"><span class="toc-number">1.</span> <span class="toc-text">窗口</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E7%AA%97%E5%8F%A3%E9%9A%90%E8%97%8F%E5%92%8C%E6%81%A2%E5%A4%8D"><span class="toc-number">1.1.</span> <span class="toc-text">主窗口隐藏和恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E7%AA%97%E5%8F%A3"><span class="toc-number">1.1.1.</span> <span class="toc-text">主窗口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-%E4%B8%BB%E7%AA%97%E5%8F%A3"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">为什么需要 主窗口?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E4%B8%BB%E7%AA%97%E5%8F%A3%E6%98%BE%E7%A4%BA"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">恢复主窗口显示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%BA%E5%88%B6%E5%85%B3%E9%97%AD%E4%B8%BB%E7%AA%97%E5%8F%A3"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">强制关闭主窗口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.2.</span> <span class="toc-text">存在的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%A0%E4%B8%BA%E9%98%BB%E6%AD%A2%E4%BA%86close%E4%BA%8B%E4%BB%B6%EF%BC%8C%E5%AF%BC%E8%87%B4-%E5%85%B3%E6%9C%BA-%E6%97%B6%E6%97%A0%E6%B3%95%E5%85%B3%E9%97%AD-%E4%B8%BB%E7%AA%97%E5%8F%A3-%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%A6%82%E4%B8%8B%E4%BB%A3%E7%A0%81%EF%BC%9A"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">因为阻止了close事件，导致 关机 时无法关闭 __主窗口__，可以使用如下代码：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E9%81%BF%E5%85%8D%E5%90%AF%E5%8A%A8-%E5%A4%9A%E4%B8%AA%E5%BA%94%E7%94%A8-%EF%BC%9B"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">为避免启动 __多个应用__；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A6%96%E6%AC%A1%E5%90%AF%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E3%80%81%E5%B0%9D%E8%AF%95%E5%9C%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%B7%B2%E8%BF%90%E8%A1%8C%E6%97%B6%E6%88%96%E5%8D%95%E5%87%BB-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-%E7%9A%84-%E5%9D%9E%E7%AB%99-%E6%88%96-%E4%BB%BB%E5%8A%A1%E6%A0%8F%E5%9B%BE%E6%A0%87-%E6%97%B6%E9%87%8D%E6%96%B0%E6%BF%80%E6%B4%BB%E5%AE%83%EF%BC%9B"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">首次启动应用程序、尝试在应用程序已运行时或单击 应用程序 的 坞站 或 任务栏图标 时重新激活它；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E5%87%BB%E6%89%98%E7%9B%98%E5%9B%BE%E6%A0%87-%E6%89%93%E5%BC%80app%EF%BC%8C%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%E8%A7%81app-tray%E3%80%82"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">双击托盘图标 打开app，完整代码见app&#x2F;tray。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.1.3.</span> <span class="toc-text">实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3"><span class="toc-number">1.1.4.</span> <span class="toc-text">文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%8F%E3%80%81%E6%9C%80%E5%A4%A7%E5%8C%96%E3%80%81%E6%9C%80%E5%B0%8F%E5%8C%96%E3%80%81%E5%85%B3%E9%97%AD"><span class="toc-number">1.2.</span> <span class="toc-text">全屏、最大化、最小化、关闭</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%8F"><span class="toc-number">1.2.1.</span> <span class="toc-text">全屏</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%97%B6%E8%BF%9B%E5%85%A5%E5%85%A8%E5%B1%8F"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">创建时进入全屏</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8API%E8%BF%9B%E5%85%A5%E5%85%A8%E5%B1%8F"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">使用API进入全屏</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%8F%E7%8A%B6%E6%80%81%E7%9A%84%E8%8E%B7%E5%8F%96"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">全屏状态的获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%8F%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%9B%91%E5%90%AC"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">全屏事件的监听</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTML-API%E6%97%A0%E6%B3%95%E5%92%8C%E7%AA%97%E5%8F%A3%E8%81%94%E5%8A%A8"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">HTML API无法和窗口联动</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%A4%A7%E5%8C%96%E3%80%81%E6%9C%80%E5%B0%8F%E5%8C%96"><span class="toc-number">1.2.2.</span> <span class="toc-text">最大化、最小化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AA%97%E5%8F%A3%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">创建窗口配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">相关事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E7%8A%B6%E6%80%81API"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">相关状态API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6API"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">控制API</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E6%81%A2%E5%A4%8D"><span class="toc-number">1.2.3.</span> <span class="toc-text">窗口恢复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E7%AA%97%E5%8F%A3"><span class="toc-number">1.3.</span> <span class="toc-text">创建和管理窗口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AA%97%E5%8F%A3"><span class="toc-number">1.3.1.</span> <span class="toc-text">创建窗口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AA%97%E5%8F%A3"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">简单创建一个窗口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E7%AA%97%E5%8F%A3"><span class="toc-number">1.3.2.</span> <span class="toc-text">管理窗口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%BA%94%E7%94%A8%E5%88%9B%E5%BB%BA%E7%9A%84%E7%AA%97%E5%8F%A3"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">管理应用创建的窗口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E7%94%A8%E6%88%B7%E5%88%9B%E5%BB%BA%E7%9A%84%E7%AA%97%E5%8F%A3"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">管理用户创建的窗口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E7%AA%97%E5%8F%A3"><span class="toc-number">1.3.3.</span> <span class="toc-text">关闭窗口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#win-close"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">win.close()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#win-destroy"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">win.destroy()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#win-hide"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">win.hide()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">1.3.4.</span> <span class="toc-text">其他</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E4%B9%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1"><span class="toc-number">1.4.</span> <span class="toc-text">窗口之间的通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%BF%9B%E7%A8%8B%E5%B9%B2%E9%A2%84%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.1.</span> <span class="toc-text">主进程干预方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E5%AD%90%E7%AA%97%E5%8F%A3%E9%80%9A%E4%BF%A1"><span class="toc-number">1.4.2.</span> <span class="toc-text">父子窗口通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8window-open"><span class="toc-number">1.4.3.</span> <span class="toc-text">使用window.open</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.5.</span> <span class="toc-text">窗口事件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%8A%A0%E8%BD%BD%E6%97%B6"><span class="toc-number">1.5.1.</span> <span class="toc-text">窗口加载时</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%A7%BB%E5%8A%A8%E7%AA%97%E5%8F%A3"><span class="toc-number">1.5.2.</span> <span class="toc-text">用户移动窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%94%B9%E5%8F%98%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F"><span class="toc-number">1.5.3.</span> <span class="toc-text">用户改变窗口大小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E7%9A%84%E5%86%85%E5%AE%B9%E5%BC%82%E5%B8%B8%E4%BA%8B%E4%BB%B6%EF%BC%88webContent%E4%BA%8B%E4%BB%B6%EF%BC%89"><span class="toc-number">1.5.4.</span> <span class="toc-text">窗口的内容异常事件（webContent事件）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%85%B3%E9%97%AD%EF%BC%88%E5%8C%85%E6%8B%AC%E6%84%8F%E5%A4%96%E5%85%B3%E9%97%AD%EF%BC%89"><span class="toc-number">1.5.5.</span> <span class="toc-text">窗口关闭（包括意外关闭）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3-1"><span class="toc-number">1.5.6.</span> <span class="toc-text">文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E7%9A%84%E8%81%9A%E7%84%A6%E5%92%8C%E5%A4%B1%E7%84%A6"><span class="toc-number">1.6.</span> <span class="toc-text">窗口的聚焦和失焦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E7%84%A6"><span class="toc-number">1.6.1.</span> <span class="toc-text">聚焦</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AA%97%E5%8F%A3%E6%97%B6%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">创建窗口时配置：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E8%81%9A%E7%84%A6%E7%9A%84api"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">关于聚焦的api</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96api%E5%89%AF%E4%BD%9C%E7%94%A8%E5%92%8C%E8%81%9A%E7%84%A6%E6%9C%89%E5%85%B3%E7%9A%84%EF%BC%9A"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">其他api副作用和聚焦有关的：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%B1%E7%84%A6"><span class="toc-number">1.6.2.</span> <span class="toc-text">失焦</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%A4%B1%E7%84%A6%E7%9A%84api"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">关于失焦的api</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96api%E5%89%AF%E4%BD%9C%E7%94%A8%E5%92%8C%E5%A4%B1%E7%84%A6%E6%9C%89%E5%85%B3%E7%9A%84%EF%BC%9A"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">其他api副作用和失焦有关的：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.</span> <span class="toc-text">窗口类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E8%BE%B9%E6%A1%86%E7%AA%97%E5%8F%A3"><span class="toc-number">1.7.1.</span> <span class="toc-text">无边框窗口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0%EF%BC%9A"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">描述：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.7.1.2.</span> <span class="toc-text">实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#macOS-%E4%B8%8B%E7%8B%AC%E6%9C%89%E7%9A%84%E6%97%A0%E8%BE%B9%E6%A1%86"><span class="toc-number">1.7.1.3.</span> <span class="toc-text">macOS 下独有的无边框</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-0-3-3-%E9%85%8D%E7%BD%AEtitleBarStyle-39-customButtonsOnHover-39"><span class="toc-number">1.7.1.3.1.</span> <span class="toc-text">1.1.0.3.3. 配置titleBarStyle: &#39;customButtonsOnHover&#39;</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E8%BE%B9%E6%A1%86%E7%AA%97%E5%8F%A3%E5%B8%B8%E8%A7%81%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.7.1.4.</span> <span class="toc-text">无边框窗口常见的问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E5%AD%90%E7%AA%97%E5%8F%A3"><span class="toc-number">1.7.2.</span> <span class="toc-text">父子窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%80%81%E7%AA%97%E5%8F%A3"><span class="toc-number">1.7.3.</span> <span class="toc-text">模态窗口</span></a></li></ol></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(http://tvshow.date/images/1504170750981724.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">王美的个人博客</a></span><span class="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/Share/"><i class="fa-fw fas fa-heart"></i><span> Share</span></a></div><div class="menus_item"><a class="site-page" href="/Diary/"><i class="fa-fw fas fa-paint-brush"></i><span> Diary</span></a></div><div class="menus_item"><a class="site-page" href="/About/"><i class="fa-fw fas fa-info"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">electron窗口管理</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-01-07T07:32:15.000Z" title="发表于 2021-01-07 15:32:15">2021-01-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-03-09T14:07:44.053Z" title="更新于 2021-03-09 22:07:44">2021-03-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/electron/">electron</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="窗口"><a href="#窗口" class="headerlink" title="窗口"></a>窗口</h1><h2 id="主窗口隐藏和恢复"><a href="#主窗口隐藏和恢复" class="headerlink" title="主窗口隐藏和恢复"></a>主窗口隐藏和恢复</h2><h3 id="主窗口"><a href="#主窗口" class="headerlink" title="主窗口"></a>主窗口</h3><h4 id="为什么需要-主窗口"><a href="#为什么需要-主窗口" class="headerlink" title="为什么需要 主窗口?"></a>为什么需要 <strong>主窗口</strong>?</h4><p>一个应用存在着许多的窗口，需要一个窗口作为 __主窗口__，如果该窗口关闭，则意味着整个应用被关闭。</p>
<p>场景：在应用只有一个页面的时，用户点击关闭按钮，不想让整个应用关闭，而是隐藏；<br>例如：其他的app，像微信，QQ等桌面端。  </p>
<p>主进程代码示例，完整代码在本应用的<code>app/browser-window/index.ts</code>处</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mainWindowId: number</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> browserWindow = <span class="keyword">new</span> BrowserWindow()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 记录下主窗口id</span></span><br><span class="line"><span class="keyword">if</span> (!mainWindowId) &#123;</span><br><span class="line">  mainWindowId = browserWindow.id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">browserWindow.on(<span class="string">&#x27;close&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 如果关闭的是主窗口，阻止</span></span><br><span class="line">  <span class="keyword">if</span> (browserWindow.id === mainWindowId) &#123;</span><br><span class="line">    event.preventDefault()</span><br><span class="line">    browserWindow.hide()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="恢复主窗口显示"><a href="#恢复主窗口显示" class="headerlink" title="恢复主窗口显示"></a>恢复主窗口显示</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mainWindow = BrowserWindowsMap.get(mainWindowId)</span><br><span class="line"><span class="keyword">if</span> (mainWindow) &#123;</span><br><span class="line">  mainWindow.restore()</span><br><span class="line">  <span class="comment">// windows下如果hide之后不调用show方法而是只调用restore方法就会导致页面挂住不能用</span></span><br><span class="line">  mainWindow.show()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="强制关闭主窗口"><a href="#强制关闭主窗口" class="headerlink" title="强制关闭主窗口"></a>强制关闭主窗口</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mainWindow = BrowserWindowsMap.get(mainWindowId)</span><br><span class="line"><span class="keyword">if</span> (mainWindow) &#123;</span><br><span class="line">  mainWindowId = <span class="number">-1</span></span><br><span class="line">  mainWindow.close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h3><h4 id="因为阻止了close事件，导致-关机-时无法关闭-主窗口-，可以使用如下代码："><a href="#因为阻止了close事件，导致-关机-时无法关闭-主窗口-，可以使用如下代码：" class="headerlink" title="因为阻止了close事件，导致 关机 时无法关闭 __主窗口__，可以使用如下代码："></a>因为阻止了close事件，导致 <strong>关机</strong> 时无法关闭 __主窗口__，可以使用如下代码：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.on(<span class="string">&#x27;before-quit&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    closeMainWindow()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><em>注：<code>macOS</code> <code>Linux</code> <code>Windows</code> <a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/app#%E4%BA%8B%E4%BB%B6%EF%BC%9Abefore-quit">完整文档</a></em>  </p>
<h4 id="为避免启动-多个应用-；"><a href="#为避免启动-多个应用-；" class="headerlink" title="为避免启动 __多个应用__；"></a>为避免启动 __多个应用__；</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.on(<span class="string">&#x27;second-instance&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> mainWindow = BrowserWindowsMap.get(mainWindowId)</span><br><span class="line">  <span class="keyword">if</span> (mainWindow) &#123;</span><br><span class="line">    mainWindow.restore()</span><br><span class="line">    mainWindow.show()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><em>注：<code>macOS</code> <code>Linux</code> <code>Windows</code> <a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/app#%E4%BA%8B%E4%BB%B6-second-instance">完整文档</a></em>  </p>
<h4 id="首次启动应用程序、尝试在应用程序已运行时或单击-应用程序-的-坞站-或-任务栏图标-时重新激活它；"><a href="#首次启动应用程序、尝试在应用程序已运行时或单击-应用程序-的-坞站-或-任务栏图标-时重新激活它；" class="headerlink" title="首次启动应用程序、尝试在应用程序已运行时或单击 应用程序 的 坞站 或 任务栏图标 时重新激活它；"></a>首次启动应用程序、尝试在应用程序已运行时或单击 <strong>应用程序</strong> 的 <strong>坞站</strong> 或 <strong>任务栏图标</strong> 时重新激活它；</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.on(<span class="string">&#x27;activate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (mainWindow) &#123;</span><br><span class="line">    mainWindow.restore()</span><br><span class="line">    mainWindow.show()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><em>注：<code>macOS</code> <a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/app#%E4%BA%8B%E4%BB%B6-second-instance">文档</a></em></p>
<h4 id="双击托盘图标-打开app，完整代码见app-tray。"><a href="#双击托盘图标-打开app，完整代码见app-tray。" class="headerlink" title="双击托盘图标 打开app，完整代码见app/tray。"></a><strong>双击托盘图标</strong> 打开<code>app</code>，完整代码见<code>app/tray</code>。</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tray.on(<span class="string">&#x27;double-click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (mainWindow) &#123;</span><br><span class="line">    mainWindow.restore()</span><br><span class="line">    mainWindow.show()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><em>注：<code>macOS</code>  <code>Windows</code> <a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/tray#event-double-click-macos-windows">文档</a></em></p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><blockquote>
<p>你可以操作本应用的主窗口</p>
</blockquote>
<h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><p>如果你还是新手，或者没有开发过<code>electron</code>应用，浏览器打开 <a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/tutorial/first-app#%E6%89%93%E9%80%A0%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA-electron-%E5%BA%94%E7%94%A8">打造你的第一个 Electron 应用
</a></p>
<h2 id="全屏、最大化、最小化、关闭"><a href="#全屏、最大化、最小化、关闭" class="headerlink" title="全屏、最大化、最小化、关闭"></a>全屏、最大化、最小化、关闭</h2><h3 id="全屏"><a href="#全屏" class="headerlink" title="全屏"></a>全屏</h3><h4 id="创建时进入全屏"><a href="#创建时进入全屏" class="headerlink" title="创建时进入全屏"></a>创建时进入全屏</h4><blockquote>
<p>配置<code>new BrowserWindow(&#123; fullscreen:true &#125;)</code>  </p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: true, height:&#x27;100px&#x27; &#125;</span></span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> win = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">fullscreen</span>:<span class="literal">true</span>,<span class="attr">fullscreenable</span>:<span class="literal">true</span> &#125;)</span><br><span class="line">win.loadURL(<span class="string">&#x27;https://github.com&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="使用API进入全屏"><a href="#使用API进入全屏" class="headerlink" title="使用API进入全屏"></a>使用<code>API</code>进入全屏</h4><blockquote>
<p>确保当前窗口的<code>fullscreenable:true</code>，以下<code>API</code>才能使用</p>
</blockquote>
<ol>
<li><code>win.setFullScreen(flag)</code>，设置全屏状态；</li>
<li><code>win.setSimpleFullScreen(flag)</code>，<code>macOS</code>下独有，设置简单全屏。</li>
</ol>
<h4 id="全屏状态的获取"><a href="#全屏状态的获取" class="headerlink" title="全屏状态的获取"></a>全屏状态的获取</h4><ol>
<li><code>win.fullScreen</code>，来判断当前窗口是否全屏；</li>
<li><code>win.isFullScreen()</code>，<code>macOS</code>独有；</li>
<li><code>win.isSimpleFullScreen()</code>，<code>macOS</code>独有。</li>
</ol>
<h4 id="全屏事件的监听"><a href="#全屏事件的监听" class="headerlink" title="全屏事件的监听"></a>全屏事件的监听</h4><ol>
<li><code>rezise</code> 调整窗口大小后触发;</li>
<li><code>enter-full-screen</code> 窗口进入全屏状态时触发;</li>
<li><code>leave-full-screen</code> 窗口离开全屏状态时触发;</li>
<li><code>enter-html-full-screen</code> 窗口进入由HTML API 触发的全屏状态时触发;</li>
<li><code>leave-html-full-screen</code> 窗口离开由HTML API触发的全屏状态时触发。</li>
</ol>
<h4 id="HTML-API无法和窗口联动"><a href="#HTML-API无法和窗口联动" class="headerlink" title="HTML API无法和窗口联动"></a><code>HTML</code> <code>API</code>无法和窗口联动</h4><p><strong>试一试</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: true, height:&#x27;200px&#x27; &#125;</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> BaseWebPreferences = &#123; </span><br><span class="line">    nodeIntegration: <span class="literal">true</span>,</span><br><span class="line">    preload: path.resolve(__dirname, <span class="string">&#x27;./fullScreen.js&#x27;</span>), </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> win = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">webPreferences</span>: BaseWebPreferences &#125;)</span><br><span class="line">win.loadURL(<span class="string">&#x27;file:///&#x27;</span> + path.resolve(__dirname, <span class="string">&#x27;../playground/index.html#/demo/full-screen&#x27;</span>))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用按钮全屏和退出全屏是可以的，但是先点击左上角🚥全屏，再使用按钮退出全屏，是不行的。因为无法知道当前的状态是全屏，还是不是全屏。</p>
</blockquote>
<p>解决办法：，将<code>win.setFullScreen(flag)</code>方法挂载到窗口的<code>window</code>上</p>
<h3 id="最大化、最小化"><a href="#最大化、最小化" class="headerlink" title="最大化、最小化"></a>最大化、最小化</h3><h4 id="创建窗口配置"><a href="#创建窗口配置" class="headerlink" title="创建窗口配置"></a>创建窗口配置</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/browser-window#new-browserwindowoptions">完整API文档</a></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: true, height:&#x27;100px&#x27; &#125;</span></span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> win = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">minWidth</span>:<span class="number">300</span>,<span class="attr">minHeight</span>:<span class="number">300</span>,<span class="attr">maxWidth</span>:<span class="number">500</span>,<span class="attr">maxHeight</span>:<span class="number">500</span>,<span class="attr">width</span>:<span class="number">600</span>,<span class="attr">height</span>:<span class="number">600</span> &#125;)</span><br><span class="line">win.loadURL(<span class="string">&#x27;https://github.com&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><em>当使用 <code>minWidth/maxWidth/minHeight/maxHeight</code> 设置最小或最大窗口大小时, 它只限制用户。 它不会阻止您将不符合大小限制的值传递给 <code>setBounds/setSize</code> 或 <code>BrowserWindow</code> 的构造函数。</em></p>
<h4 id="相关事件"><a href="#相关事件" class="headerlink" title="相关事件"></a>相关事件</h4><table>
<thead>
<tr>
<th>事件名称</th>
<th>触发条件</th>
</tr>
</thead>
<tbody><tr>
<td><code>maximize</code></td>
<td>窗口最大化时触发</td>
</tr>
<tr>
<td><code>unmaximize</code></td>
<td>当窗口从最大化状态退出时触发</td>
</tr>
<tr>
<td><code>minimize</code></td>
<td>窗口最小化时触发</td>
</tr>
<tr>
<td><code>restore</code></td>
<td>当窗口从最小化状态恢复时触发</td>
</tr>
</tbody></table>
<h4 id="相关状态API"><a href="#相关状态API" class="headerlink" title="相关状态API"></a>相关状态API</h4><ol>
<li><code>win.minimizable</code> 窗口是否可以最小化</li>
<li><code>win.maximizable</code> 窗口是否可以最大化</li>
<li><code>win.isMaximized()</code> 是否最大化</li>
<li><code>win.isMinimized()</code> 是否最小化</li>
</ol>
<h4 id="控制API"><a href="#控制API" class="headerlink" title="控制API"></a>控制API</h4><ol>
<li><code>win.maximize()</code> 使窗口最大化</li>
<li><code>win.unmaximize()</code> 退出最大化</li>
<li><code>win.minimize()</code> 使窗口最小化</li>
<li><code>win.unminimize()</code> 退出最小化</li>
</ol>
<h3 id="窗口恢复"><a href="#窗口恢复" class="headerlink" title="窗口恢复"></a>窗口恢复</h3><p><code>win.restore()</code> 将窗口从最小化状态恢复到以前的状态。</p>
<h2 id="创建和管理窗口"><a href="#创建和管理窗口" class="headerlink" title="创建和管理窗口"></a>创建和管理窗口</h2><p>通过<code>electron</code>的<code>BrowserWindow</code>模块，我们可以轻松 <strong>创建</strong> 和 <strong>管理</strong> 窗口。</p>
<p>在浏览器打开 <a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/browser-window">完整的API文档</a></p>
<p>每个应用，因为业务的不同；创建和管理窗口的方式和流程也大不相同；这里我们以下流程为例：</p>
<img src= "/img/loading.gif" data-lazy-src="http://mei160.cn/images/window-create.png" alt="window create">


<h3 id="创建窗口"><a href="#创建窗口" class="headerlink" title="创建窗口"></a>创建窗口</h3><p>通过<code>BrowserWindow</code>，来 <strong>创建</strong> 或者 <strong>管理</strong> 新的浏览器窗口，每个浏览器窗口都有一个进程来管理。</p>
<p>这里，我们把 <strong>创建</strong> 和 <strong>管理__，分为 __用户行为</strong> 和 __应用本身__。</p>
<p><strong>应用本身</strong> 即是：应用启动 ——&gt; 窗口创建 –&gt; 窗口展示<br><strong>用户行为</strong> 即是：窗口已经创建完毕，用户点击<code>a</code>链接而创建的窗口的行为</p>
<h4 id="简单创建一个窗口"><a href="#简单创建一个窗口" class="headerlink" title="简单创建一个窗口"></a>简单创建一个窗口</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: false, height:&#x27;100px&#x27; &#125;</span></span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> win = <span class="keyword">new</span> BrowserWindow();</span><br><span class="line">win.loadURL(<span class="string">&#x27;https://github.com&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><p>__问题__：<code>electron</code>的<code>BrowserWindow</code>模块在创建时，如果没有配置<code>show:false</code>，在创建之时就会显示出来，且默认的背景是白色；然后窗口请求<code>HTML</code>，会出现闪烁。   </p>
<p><a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/browser-window#%E4%BD%BF%E7%94%A8ready-to-show%E4%BA%8B%E4%BB%B6">完整api文档</a></p>
<p><strong>解决</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: true, height:&#x27;200px&#x27; &#125;</span></span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> win = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">show</span>:<span class="literal">false</span>,<span class="attr">x</span>:<span class="number">100</span>,<span class="attr">y</span>:<span class="number">100</span> &#125;);</span><br><span class="line"></span><br><span class="line">win.loadURL(<span class="string">&#x27;https://github.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line">win.on(<span class="string">&#x27;ready-to-show&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    win.show();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>__对比上面简单创建窗口__，可以明显看出2者的区别</p>
<p><code>new BrowserWindow(options)</code>，<a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/browser-window#new-browserwindowoptions">options配置文档</a>  </p>
<h3 id="管理窗口"><a href="#管理窗口" class="headerlink" title="管理窗口"></a>管理窗口</h3><h4 id="管理应用创建的窗口"><a href="#管理应用创建的窗口" class="headerlink" title="管理应用创建的窗口"></a>管理应用创建的窗口</h4><p><code>BrowserWindow</code>模块在创建窗口时，会返回 <strong>窗口实例</strong></p>
<p>在这里使用<code>Map</code>对象来存储这些 <strong>窗口实例</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> BrowserWindowsMap = <span class="keyword">new</span> <span class="built_in">Map</span>&lt;<span class="built_in">number</span>, BrowserWindow&gt;()</span><br><span class="line"><span class="keyword">let</span> mainWindowId: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> browserWindows = <span class="keyword">new</span> BrowserWindow(&#123; show:<span class="literal">false</span> &#125;)</span><br><span class="line">browserWindows.loadURL(<span class="string">&#x27;https://github.com&#x27;</span>)</span><br><span class="line">browserWindows.once(<span class="string">&#x27;ready-to-show&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  browserWindows.show()</span><br><span class="line">&#125;)</span><br><span class="line">BrowserWindowsMap.set(browserWindow.id, browserWindow)</span><br><span class="line">mainWindowId = browserWindow.id  <span class="comment">// 记录当前窗口为主窗口</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>代码中提到 __主窗口__，什么是主窗口？<a href="./index.html#/browser/awaken">主窗口隐藏和恢复</a>章节</p>
</blockquote>
<p>__窗口被关闭__，得把<code>Map</code>中的实例删除。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">browserWindow.on(<span class="string">&#x27;closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  BrowserWindowsMap?.delete(browserWindowID)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="管理用户创建的窗口"><a href="#管理用户创建的窗口" class="headerlink" title="管理用户创建的窗口"></a>管理用户创建的窗口</h4><p>一个窗口中存在许多的链接，不管是链接跳转，或是创建新的窗口，我们都需要管理这些窗口。</p>
<p><strong>使用<code>new-window</code>监听窗口创建</strong><br>使用<code>new-window</code>可监听 <strong>新窗口</strong> 的创建。浏览器打开<a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/web-contents#event-new-window">完整文档</a></p>
<p>核心代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建窗口监听</span></span><br><span class="line">browserWindow.webContents.on(<span class="string">&#x27;new-window&#x27;</span>, <span class="function">(<span class="params">event, url, frameName, disposition</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/** <span class="doctag">@params <span class="type">&#123;string&#125;</span> <span class="variable">disposition</span></span></span></span><br><span class="line"><span class="comment">  *  new-window : window.open调用</span></span><br><span class="line"><span class="comment">  *  background-tab: command+click</span></span><br><span class="line"><span class="comment">  *  foreground-tab: 右键点击新标签打开或点击a标签target _blank打开</span></span><br><span class="line"><span class="comment">  * /</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：关于<code>disposition</code>字段的解释，移步<a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/web-contents#webcontents">electron文档</a>、<a target="_blank" rel="noopener" href="https://github.com/electron/electron/blob/72a089262e31054eabd342294ccdc4c414425c99/shell/browser/api/electron_api_web_contents.cc">electron源码</a>、<a target="_blank" rel="noopener" href="https://chromium.googlesource.com/chromium/src/+/66.0.3359.158/ui/base/mojo/window_open_disposition_struct_traits.h">chrome 源码</a></p>
</blockquote>
<p><strong>扩展<code>new-window</code></strong></p>
<ul>
<li>可以被 当前窗口的 <code>new-window</code>事件捕捉到的</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.open(<span class="string">&#x27;https://github.com&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;https://github.com&#x27;</span> <span class="attr">target</span>=<span class="string">&#x27;__blank&#x27;</span>&gt;</span>链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>不可被 当前窗口的 <code>new-window</code>事件捕捉到的<br>以下api需要窗口 集成node，即 <strong>主进程</strong> 创建时需配置<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> parent = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">webPreferences</span>:&#123;<span class="attr">nodeIntegration</span>: <span class="literal">true</span>&#125;&#125;);</span><br></pre></td></tr></table></figure>
<strong>渲染进程</strong> 使用<code>BrowserWindow</code>创建窗口<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>).remote</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> win = <span class="keyword">new</span> BrowserWindow()</span><br><span class="line">win.loadURL(<span class="string">&#x27;https://github.com&#x27;</span>)</span><br></pre></td></tr></table></figure>
<strong>应用<code>new-window</code></strong><br><strong>通过 __默认浏览器</strong> 来打开 __第三方链接<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; shell &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">openExternal</span>(<span class="params">url: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> HTTP_REGEXP = <span class="regexp">/^https?:\/\//</span></span><br><span class="line">  <span class="comment">// 非http协议不打开，防止出现自定义协议等导致的安全问题</span></span><br><span class="line">  <span class="keyword">if</span> (!HTTP_REGEXP) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> shell.openExternal(url, options)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">&#x27;open external error: &#x27;</span>, error)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建窗口监听</span></span><br><span class="line">browserWindow.webContents.on(<span class="string">&#x27;new-window&#x27;</span>, <span class="function">(<span class="params">event, url, frameName, disposition</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (disposition === <span class="string">&#x27;foreground-tab&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 阻止鼠标点击链接</span></span><br><span class="line">      event.preventDefault()</span><br><span class="line">      openExternal(url)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="关闭窗口"><a href="#关闭窗口" class="headerlink" title="关闭窗口"></a>关闭窗口</h3><p>关闭窗口或者隐藏的<code>API</code></p>
<h4 id="win-close"><a href="#win-close" class="headerlink" title="win.close()"></a><code>win.close()</code></h4><ol>
<li>关闭页面，如果阻止<code>close</code>事件，将不会关闭页面，这会 __阻止计算机关闭__；</li>
<li>关闭页面的服务，如<code>websocket</code>，下次打开窗口，窗口中的页面会 __重新渲染__；</li>
<li>通过这个<code>API</code>触发的<code>close</code>事件在 <code>unload</code> 和 <code>beforeunload</code>之前触发，通过这点可以实现 __关闭时触发弹窗__；</li>
<li>会被<code>closed</code>事件捕捉到。</li>
</ol>
<p>__例子__：实现关闭窗口之前触发弹窗<br>代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: true, height:&#x27;100px&#x27; &#125;</span></span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> browserWindows = <span class="keyword">new</span> BrowserWindow(&#123;<span class="attr">webPreferences</span>:&#123;<span class="attr">nodeIntegration</span>: <span class="literal">true</span>,<span class="attr">webSecurity</span>: <span class="literal">false</span>&#125;&#125;)</span><br><span class="line">browserWindows.loadURL(<span class="string">&#x27;file:///&#x27;</span> + path.resolve(__dirname, <span class="string">&#x27;../playground/index.html#/demo/window-close&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>注：</p>
<ul>
<li>上面代码，只能应用于electron端，在web端刷新不起作用；web端无法在页面关闭或者刷新之前阻塞浏览器；<img src= "/img/loading.gif" data-lazy-src="http://mei160.cn/images/close-window-model.png" alt="close-window-model" />
<img src= "/img/loading.gif" data-lazy-src="http://mei160.cn/images/close-window-model2.png" alt="close-window-model" /></li>
<li>阻止关闭窗口出现的弹窗，<code>img</code>元素外链<code>url</code>不起作用，会发出请求，但是不会渲染出来，可以使用<code>div+background</code>的方式；</li>
<li>关于<code>beforeunload</code><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload_event">完整<code>API</code>文档</a></li>
</ul>
<h4 id="win-destroy"><a href="#win-destroy" class="headerlink" title="win.destroy()"></a><code>win.destroy()</code></h4><ol>
<li>强制退出，无视<code>close</code>事件；</li>
<li>关闭页面，以及页面内的服务，下次打开窗口，窗口中的页面会重新渲染；</li>
<li>会被<code>closed</code>事件捕捉到。</li>
</ol>
<h4 id="win-hide"><a href="#win-hide" class="headerlink" title="win.hide()"></a><code>win.hide()</code></h4><blockquote>
<p>这个隐藏窗口。</p>
</blockquote>
<ol>
<li>隐藏窗口，会触发<code>hide</code>和<code>blur</code>事件，同样也是可以通过<code>event.preventDefault()</code>来阻止</li>
<li>只是隐藏窗口，通过<code>win.show()</code>，可以将窗口显现，并且会保持原来的窗口，里面的服务也不会挂断</li>
</ol>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li>关于页面可见性，可参见<a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/API/browser-window#%E9%A1%B5%E9%9D%A2%E5%8F%AF%E8%A7%81%E6%80%A7">文档</a>；</li>
<li><strong>主窗口的隐藏和唤醒</strong> 的具体细节，可参见本章的 <a href="./index.html#/browser/awaken">主窗口隐藏和恢复</a>章节；</li>
<li>窗口在被创建之后，窗口实例各种 <strong>事件触发顺序</strong> 可参见 <a href="./index.html#/browser/window-event">窗口触发顺序</a>章节；</li>
<li>__窗口通信__，可参见 <a href="./index.html#/browser/communication">窗口通信</a>章节；</li>
<li>__无边框窗口__、__父子窗口__、__模态窗口__，参见<a href="./index.html#/browser/window-type">窗口类型</a>章节；</li>
</ul>
<h2 id="窗口之间的通信"><a href="#窗口之间的通信" class="headerlink" title="窗口之间的通信"></a>窗口之间的通信</h2><h3 id="主进程干预方式"><a href="#主进程干预方式" class="headerlink" title="主进程干预方式"></a>主进程干预方式</h3><p>主进程是可以干预渲染进程生成新的窗口的，只需要在创建窗口时，<code>webContents</code> 监听 <code>new-window</code> </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; PRELOAD_FILE &#125; <span class="keyword">from</span> <span class="string">&#x27;app/config&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; browserWindow &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> BaseWebPreferences: Electron.BrowserWindowConstructorOptions[<span class="string">&#x27;webPreferences&#x27;</span>] = &#123;</span><br><span class="line">  nodeIntegration: <span class="literal">true</span>,</span><br><span class="line">  webSecurity: <span class="literal">false</span>,</span><br><span class="line">  preload: path.resolve(__dirname, PRELOAD_FILE),</span><br><span class="line">  enableRemoteModule:<span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建窗口监听</span></span><br><span class="line">browserWindow.webContents.on(<span class="string">&#x27;new-window&#x27;</span>, <span class="function">(<span class="params">event, url, frameName, disposition</span>) =&gt;</span> &#123;</span><br><span class="line">    event.preventDefault()</span><br><span class="line">    <span class="comment">// 在通过BrowserWindow创建窗口</span></span><br><span class="line">    <span class="keyword">const</span> win = <span class="keyword">new</span> BrowserWindow(&#123; </span><br><span class="line">      show:<span class="literal">false</span>, </span><br><span class="line">      webPreferences: &#123;</span><br><span class="line">        ...BaseWebPreferences,</span><br><span class="line">        additionalArguments:[<span class="string">`--parentWindow=<span class="subst">$&#123;browserWindow.id&#125;</span>`</span>] <span class="comment">// 把父窗口的id传过去</span></span><br><span class="line">        enableRemoteModule:<span class="literal">true</span></span><br><span class="line">      &#125; </span><br><span class="line">    &#125;);</span><br><span class="line">    win.loadURl(url);</span><br><span class="line">    win.once(<span class="string">&#x27;ready-to-show&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        win.show()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在preload.js文件<code>window.process.argv</code>，便能拿到父窗口的id，<code>window.process.argv</code>是一个字符串数组，可以使用<a target="_blank" rel="noopener" href='https://github.com/yargs/yargs'>yargs</a>来解析</p>
<p>preload.js 代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; argv &#125; <span class="keyword">from</span> <span class="string">&#x27;yargs&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(argv);</span><br></pre></td></tr></table></figure>
<img src= "/img/loading.gif" data-lazy-src='http://mei160.cn/images/yargv-parse.png'/>
拿到父窗口的id，便可以通信了

<p><strong>试一试</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: true, height:&#x27;600px&#x27; &#125;</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> BaseWebPreferences = &#123;</span><br><span class="line">  <span class="comment">// // 集成node</span></span><br><span class="line">  nodeIntegration: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// // 禁用同源策略</span></span><br><span class="line">  <span class="comment">// webSecurity: false,</span></span><br><span class="line">  <span class="comment">// 预加载脚本 通过绝对地址注入</span></span><br><span class="line">  preload: path.resolve(__dirname, <span class="string">&#x27;./communication1.js&#x27;</span>),</span><br><span class="line">  enableRemoteModule:<span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主窗口代码</span></span><br><span class="line"><span class="keyword">const</span> parent = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">webPreferences</span>: BaseWebPreferences, <span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">0</span> &#125;)</span><br><span class="line">parent.loadURL(</span><br><span class="line">  <span class="string">&#x27;file:///&#x27;</span> + path.resolve(__dirname, <span class="string">&#x27;../playground/index.html#/demo/communication-part1/main&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">parent.webContents.on(<span class="string">&#x27;new-window&#x27;</span>, <span class="function">(<span class="params">event, url, frameName, disposition</span>) =&gt;</span> &#123;</span><br><span class="line">  event.preventDefault()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在通过BrowserWindow创建窗口 // 子窗口代码</span></span><br><span class="line">  <span class="keyword">const</span> son = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">    webPreferences: &#123;</span><br><span class="line">      ...BaseWebPreferences,</span><br><span class="line">      additionalArguments: [<span class="string">&#x27;--parentWindowId=&#x27;</span> + parent.id],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  son.webContents.openDevTools()</span><br><span class="line">  son.loadURL(</span><br><span class="line">    <span class="string">&#x27;file:///&#x27;</span> +</span><br><span class="line">      path.resolve(__dirname, <span class="string">&#x27;../playground/index.html#/demo/communication-part1/client&#x27;</span>),</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>其余代码如下</strong>:<br>主窗口代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; ReactElement, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">&#x27;../style.module.less&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Communication</span>(<span class="params"></span>): <span class="title">ReactElement</span> </span>&#123;</span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">&#x27;父窗口&#x27;</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=&#123;style.wrap&#125;&gt;</span><br><span class="line">      &lt;a href=<span class="string">&#x27;http://www.github.com&#x27;</span> target=<span class="string">&#x27;__blank&#x27;</span>&gt;</span><br><span class="line">        通过a标签target=__blank打开新的窗口</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">window</span>.open(<span class="string">&#x27;http://www.github.com&#x27;</span>)</span><br><span class="line">        &#125;&#125;&gt;</span><br><span class="line">        通过<span class="built_in">window</span>.open打开新的窗口</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>子窗口代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; ReactElement, useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">&#x27;../style.module.less&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> COUNT_NUM = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Communication</span>(<span class="params"></span>): <span class="title">ReactElement</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [num, setNum] = useState(COUNT_NUM)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">&#x27;子窗口&#x27;</span></span><br><span class="line">    <span class="keyword">let</span> timer: NodeJS.Timeout</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (num &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setNum(num - <span class="number">1</span>)</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// @ts-ignore</span></span><br><span class="line">      <span class="built_in">window</span>.send(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">      <span class="built_in">window</span>.close()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      timer &amp;&amp; <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [num])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;style.countDown&#125;</span>&gt;</span>子窗口 &#123;num&#125; 秒之后，请看主窗口<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="父子窗口通信"><a href="#父子窗口通信" class="headerlink" title="父子窗口通信"></a>父子窗口通信</h3><p>和主进程干预，通过<code>ipc</code>通信方式差不多，只是利用父子窗口这点，不用通过<code>additionalArguments</code>传递父窗口<code>id</code>，在子窗口通过<code>window.parent</code>，就可以拿到父窗口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">browserWindow.webContents.on(<span class="string">&#x27;new-window&#x27;</span>, <span class="function">(<span class="params">event, url, frameName, disposition</span>) =&gt;</span> &#123;</span><br><span class="line">    event.preventDefault()</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 在通过BrowserWindow创建窗口</span></span><br><span class="line">    <span class="keyword">const</span> win = <span class="keyword">new</span> BrowserWindow(&#123; </span><br><span class="line">        show:<span class="literal">false</span>, </span><br><span class="line">        webPreferences:BaseWebPreferences,</span><br><span class="line">        parent:browserWindow <span class="comment">// 添加父窗口</span></span><br><span class="line">      &#125;);</span><br><span class="line">    win.loadURl(url);</span><br><span class="line">    win.once(<span class="string">&#x27;ready-to-show&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        win.show()</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>弊端：子窗口永远在父窗口之上。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: true, height:&#x27;600px&#x27; &#125;</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> BaseWebPreferences = &#123;</span><br><span class="line">  <span class="comment">// // 集成node</span></span><br><span class="line">  nodeIntegration: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// // 禁用同源策略</span></span><br><span class="line">  <span class="comment">// webSecurity: false,</span></span><br><span class="line">  <span class="comment">// 预加载脚本 通过绝对地址注入</span></span><br><span class="line">  preload: path.resolve(__dirname, <span class="string">&#x27;./communication2.js&#x27;</span>),</span><br><span class="line">  enableRemoteModule:<span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主窗口代码</span></span><br><span class="line"><span class="keyword">const</span> parent = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">webPreferences</span>: BaseWebPreferences, <span class="attr">left</span>: <span class="number">100</span>, <span class="attr">top</span>: <span class="number">0</span> &#125;)</span><br><span class="line">parent.loadURL(</span><br><span class="line">  <span class="string">&#x27;file:///&#x27;</span> + path.resolve(__dirname, <span class="string">&#x27;../playground/index.html#/demo/communication-part2/main&#x27;</span>),</span><br><span class="line">)</span><br><span class="line">parent.webContents.on(<span class="string">&#x27;new-window&#x27;</span>, <span class="function">(<span class="params">event, url, frameName, disposition</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 阻止默认事件</span></span><br><span class="line">  event.preventDefault()</span><br><span class="line">  <span class="comment">// 在通过BrowserWindow创建窗口</span></span><br><span class="line">  <span class="comment">// 子窗口代码</span></span><br><span class="line">  <span class="keyword">const</span> son = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">    webPreferences: BaseWebPreferences,</span><br><span class="line">    parent,</span><br><span class="line">    width: <span class="number">400</span>,</span><br><span class="line">    height: <span class="number">400</span>,</span><br><span class="line">    alwaysOnTop: <span class="literal">false</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// son.webContents.openDevTools();</span></span><br><span class="line">  son.loadURL(</span><br><span class="line">    <span class="string">&#x27;file:///&#x27;</span> +</span><br><span class="line">      path.resolve(__dirname, <span class="string">&#x27;../playground/index.html#/demo/communication-part2/client&#x27;</span>),</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>其余代码如下</strong>:</p>
<p>主窗口代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; ReactElement, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">&#x27;../style.module.less&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Communication</span>(<span class="params"></span>): <span class="title">ReactElement</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">&#x27;父窗口&#x27;</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=&#123;style.wrap&#125;&gt;</span><br><span class="line">      &lt;a href=<span class="string">&#x27;http://www.github.com&#x27;</span> target=<span class="string">&#x27;__blank&#x27;</span>&gt;</span><br><span class="line">        通过a标签target=__blank打开新的窗口</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">window</span>.open(<span class="string">&#x27;http://www.github.com&#x27;</span>)</span><br><span class="line">        &#125;&#125;&gt;</span><br><span class="line">        通过<span class="built_in">window</span>.open打开新的窗口</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>子窗口代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; ReactElement, useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">&#x27;../style.module.less&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> COUNT_NUM = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Communication</span>(<span class="params"></span>): <span class="title">ReactElement</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [num, setNum] = useState(COUNT_NUM)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">&#x27;子窗口&#x27;</span></span><br><span class="line">    <span class="keyword">let</span> timer: NodeJS.Timeout</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (num &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setNum(num - <span class="number">1</span>)</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// @ts-ignore</span></span><br><span class="line">      <span class="built_in">window</span>.sendToParent(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">      <span class="built_in">window</span>.close()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      timer &amp;&amp; <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [num])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;style.countDown&#125;</span>&gt;</span>子窗口 &#123;num&#125; 秒之后，请看主窗口<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="使用window-open"><a href="#使用window-open" class="headerlink" title="使用window.open"></a>使用<code>window.open</code></h3><h2 id="窗口事件"><a href="#窗口事件" class="headerlink" title="窗口事件"></a>窗口事件</h2><img src= "/img/loading.gif" data-lazy-src='http://mei160.cn/images/window-event.png'/>

<h3 id="窗口加载时"><a href="#窗口加载时" class="headerlink" title="窗口加载时"></a>窗口加载时</h3><blockquote>
<p>从上到下，依次执行</p>
</blockquote>
<table>
<thead>
<tr>
<th>环境</th>
<th>事件</th>
<th>触发时机</th>
</tr>
</thead>
<tbody><tr>
<td>webPreferences的preload</td>
<td>-</td>
<td>在页面运行其他脚本之前预先加载指定的脚本 无论页面是否集成Node, 此脚本都可以访问所有Node API 脚本路径为文件的绝对路径。</td>
</tr>
<tr>
<td>webContents</td>
<td><code>did-start-loading</code></td>
<td>当tab中的旋转指针（spinner）开始旋转时，就会触发该事件</td>
</tr>
<tr>
<td>webContents</td>
<td><code>did-start-navigation</code></td>
<td>当窗口开始导航是，触发该事件</td>
</tr>
<tr>
<td>窗口中的<code>JavaScript</code></td>
<td><code>DOMContentLoaded</code></td>
<td>初始的 HTML 文档被完全加载和解析完成</td>
</tr>
<tr>
<td>窗口中的<code>JavaScript</code></td>
<td><code>load</code></td>
<td>页面资源全部加载完成之时</td>
</tr>
<tr>
<td><code>BrowserWindow</code>实例</td>
<td><code>show</code></td>
<td>窗口显示时触发时</td>
</tr>
<tr>
<td><code>webContents</code></td>
<td><code>did-frame-navigate</code></td>
<td><code>frame</code>导航结束时时</td>
</tr>
<tr>
<td><code>webContents</code></td>
<td><code>did-navigate</code></td>
<td><code>main frame</code>导航结束时时</td>
</tr>
<tr>
<td><code>BrowserWindow</code>实例</td>
<td><code>page-title-updated</code></td>
<td>文档更改标题时触发</td>
</tr>
<tr>
<td><code>webContents</code></td>
<td><code>page-title-updated</code></td>
<td>文档更改标题时触发</td>
</tr>
<tr>
<td><code>webContents</code></td>
<td><code>dom-ready</code></td>
<td>一个框架中的文本加载完成后触发该事件</td>
</tr>
<tr>
<td><code>webContents</code></td>
<td><code>did-frame-finish-load</code></td>
<td>当框架完成导航（navigation）时触发</td>
</tr>
<tr>
<td><code>webContents</code></td>
<td><code>did-finish-load</code></td>
<td>导航完成时触发，即选项卡的旋转器将停止旋转</td>
</tr>
<tr>
<td><code>webContents</code></td>
<td><code>did-stop-loading</code></td>
<td>当tab中的旋转指针（spinner）结束旋转时，就会触发该事件</td>
</tr>
</tbody></table>
<p>##. 窗口加载完毕，用户触发事件（不包括resize和move）</p>
<table>
<thead>
<tr>
<th>事件</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>page-title-updated</code></td>
<td>文档更改标题时触发</td>
</tr>
<tr>
<td><code>blur</code></td>
<td>当窗口失去焦点时触发</td>
</tr>
<tr>
<td><code>focus</code></td>
<td>当窗口获得焦点时触发</td>
</tr>
<tr>
<td><code>hide</code></td>
<td>窗口隐藏</td>
</tr>
<tr>
<td><code>show</code></td>
<td>窗口显示</td>
</tr>
<tr>
<td><code>maximize</code></td>
<td>窗口最大化时触发（mac是双击title）</td>
</tr>
<tr>
<td><code>unmaximize</code></td>
<td>当窗口从最大化状态退出时触发</td>
</tr>
<tr>
<td><code>enter-full-screen</code></td>
<td>窗口进入全屏状态时触发</td>
</tr>
<tr>
<td><code>leave-full-screen</code></td>
<td>窗口离开全屏状态时触发</td>
</tr>
<tr>
<td><code>enter-html-full-screen</code></td>
<td>窗口进入由HTML API 触发的全屏状态时触发</td>
</tr>
<tr>
<td><code>leave-html-full-screen</code></td>
<td>窗口离开由HTML API触发的全屏状态时触发</td>
</tr>
<tr>
<td><code>always-on-top-changed</code></td>
<td>设置或取消设置窗口总是在其他窗口的顶部显示时触发。</td>
</tr>
<tr>
<td><code>app-command</code></td>
<td><code>window</code> <code>linux</code>独有</td>
</tr>
</tbody></table>
<h3 id="用户移动窗口"><a href="#用户移动窗口" class="headerlink" title="用户移动窗口"></a>用户移动窗口</h3><ol>
<li>移动窗口之前 <code>will-move</code>；</li>
<li>移动窗口中 <code>move</code>；</li>
<li>移动之后 <code>moved</code>；</li>
</ol>
<h3 id="用户改变窗口大小"><a href="#用户改变窗口大小" class="headerlink" title="用户改变窗口大小"></a>用户改变窗口大小</h3><ol>
<li>改变之前 <code>will-resize</code>；</li>
<li>改变之后 <code>resize</code></li>
</ol>
<h3 id="窗口的内容异常事件（webContent事件）"><a href="#窗口的内容异常事件（webContent事件）" class="headerlink" title="窗口的内容异常事件（webContent事件）"></a>窗口的内容异常事件（<code>webContent</code>事件）</h3><table>
<thead>
<tr>
<th>事件名</th>
<th>错误类型</th>
</tr>
</thead>
<tbody><tr>
<td><code>unresponsive</code></td>
<td>网页变得未响应时触发</td>
</tr>
<tr>
<td><code>responsive</code></td>
<td>未响应的页面变成响应时触发</td>
</tr>
<tr>
<td><code>did-fail-load</code></td>
<td>加载失败，<a target="_blank" rel="noopener" href="https://code.google.com/p/chromium/codesearch#chromium/src/net/base/net_error_list.h">错误码</a></td>
</tr>
<tr>
<td><code>did-fail-provisional-load</code></td>
<td>页面加载过程中，执行了<code>window.stop()</code></td>
</tr>
<tr>
<td><code>did-frame-finish-load</code></td>
<td></td>
</tr>
<tr>
<td><code>crashed</code></td>
<td>渲染进程崩溃或被结束时触发</td>
</tr>
<tr>
<td><code>render-process-gone</code></td>
<td>渲染进程意外失败时发出</td>
</tr>
<tr>
<td><code>plugin-crashed</code></td>
<td>有插件进程崩溃时触发</td>
</tr>
<tr>
<td><code>certificate-error</code></td>
<td>证书的链接验证失败</td>
</tr>
<tr>
<td><code>preload-error</code></td>
<td><code>preload.js</code>抛出错误</td>
</tr>
</tbody></table>
<h3 id="窗口关闭（包括意外关闭）"><a href="#窗口关闭（包括意外关闭）" class="headerlink" title="窗口关闭（包括意外关闭）"></a>窗口关闭（包括意外关闭）</h3><p>按触发顺序依次：（带window的是渲染进程中的）</p>
<ul>
<li>关闭之前：close</li>
<li>window.onbeforeunload</li>
<li>window.onunload</li>
<li>关闭之后：closed</li>
</ul>
<h3 id="文档-1"><a href="#文档-1" class="headerlink" title="文档"></a>文档</h3><ol>
<li><a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/browser-window">BrowserWindow</a>;</li>
<li><a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/web-contents">webContents</a>;</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Events/DOMContentLoaded">DOMContended</a></li>
</ol>
<h2 id="窗口的聚焦和失焦"><a href="#窗口的聚焦和失焦" class="headerlink" title="窗口的聚焦和失焦"></a>窗口的聚焦和失焦</h2><h3 id="聚焦"><a href="#聚焦" class="headerlink" title="聚焦"></a>聚焦</h3><h4 id="创建窗口时配置："><a href="#创建窗口时配置：" class="headerlink" title="创建窗口时配置："></a>创建窗口时配置：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: true, height:&#x27;150px&#x27; &#125;</span></span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> win = <span class="keyword">new</span> BrowserWindow();</span><br><span class="line">win.loadURL(<span class="string">&#x27;https://github.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> win2 = <span class="keyword">new</span> BrowserWindow(&#123;<span class="attr">x</span>:<span class="number">100</span>,<span class="attr">y</span>:<span class="number">100</span>&#125;)</span><br><span class="line">    win2.loadURL(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">&#125;,<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p><code>focusable:true</code>  窗口便可聚焦，便可以使用聚焦的<code>api</code></p>
<p><code>focusable:false</code> 在 <code>Windows</code> 中设置 <code>focusable: false</code> 也意味着设置了<code>skipTaskbar: true</code>. 在 <code>Linux</code> 中设置 <code>focusable: false</code> 时窗口停止与 <code>wm</code> 交互, 并且窗口将始终置顶。</p>
<p>以下讨论的情况仅为<code>focusable:true</code>情况下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> win = <span class="keyword">new</span> BrowserWindow() <span class="comment">// focusable:true 为默认配置</span></span><br></pre></td></tr></table></figure>

<h4 id="关于聚焦的api"><a href="#关于聚焦的api" class="headerlink" title="关于聚焦的api"></a>关于聚焦的<code>api</code></h4><table>
<thead>
<tr>
<th>api</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td><code>BrowserWindow.getFocusedWindow()</code></td>
<td>来获取聚焦的窗口</td>
</tr>
<tr>
<td><code>win.isFocused()</code></td>
<td>判断窗口是否聚焦</td>
</tr>
<tr>
<td><code>win.on(&#39;focus&#39;,cb)</code></td>
<td>来监听窗口是否聚焦</td>
</tr>
<tr>
<td><code>win.focus()</code></td>
<td>手动聚焦窗口</td>
</tr>
</tbody></table>
<h4 id="其他api副作用和聚焦有关的："><a href="#其他api副作用和聚焦有关的：" class="headerlink" title="其他api副作用和聚焦有关的："></a>其他<code>api</code>副作用和聚焦有关的：</h4><table>
<thead>
<tr>
<th>api</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td><code>win.show()</code></td>
<td>显示窗口，并且聚焦于窗口</td>
</tr>
<tr>
<td><code>win.showInactive()</code></td>
<td>显示窗口，但是不会聚焦于窗口</td>
</tr>
</tbody></table>
<h3 id="失焦"><a href="#失焦" class="headerlink" title="失焦"></a>失焦</h3><h4 id="关于失焦的api"><a href="#关于失焦的api" class="headerlink" title="关于失焦的api"></a>关于失焦的<code>api</code></h4><table>
<thead>
<tr>
<th>api</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td><code>win.blur()</code></td>
<td>取消窗口聚焦</td>
</tr>
<tr>
<td><code>win.on(&#39;blur&#39;,cb)</code></td>
<td>监听失焦</td>
</tr>
</tbody></table>
<h4 id="其他api副作用和失焦有关的："><a href="#其他api副作用和失焦有关的：" class="headerlink" title="其他api副作用和失焦有关的："></a>其他<code>api</code>副作用和失焦有关的：</h4><table>
<thead>
<tr>
<th>api</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td><code>win.hide()</code></td>
<td>隐藏窗口，并且会触发失焦事件</td>
</tr>
</tbody></table>
<h2 id="窗口类型"><a href="#窗口类型" class="headerlink" title="窗口类型"></a>窗口类型</h2><h3 id="无边框窗口"><a href="#无边框窗口" class="headerlink" title="无边框窗口"></a>无边框窗口</h3><h4 id="描述："><a href="#描述：" class="headerlink" title="描述："></a>描述：</h4><p>无边框窗口是不带外壳（包括窗口边框、工具栏等），只含有网页内容的窗口</p>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><p><code>Windows</code> <code>macOS</code> <code>Linux</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: true, height:&#x27;100px&#x27; &#125;</span></span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> win = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">600</span>, <span class="attr">frame</span>: <span class="literal">false</span> &#125;)</span><br><span class="line">win.loadURL(<span class="string">&#x27;https://github.com&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>在<code>macOS</code>下，还有不同的实现方式，<a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/frameless-window#macos-%E4%B8%8A%E7%9A%84%E5%85%B6%E4%BB%96%E6%96%B9%E6%A1%88">完整文档</a></p>
<h4 id="macOS-下独有的无边框"><a href="#macOS-下独有的无边框" class="headerlink" title="macOS 下独有的无边框"></a><code>macOS</code> 下独有的无边框</h4><ul>
<li>配置<code>titleBarStyle: &#39;hidden&#39;</code><blockquote>
<p>返回一个隐藏标题栏的全尺寸内容窗口，在左上角仍然有标准的窗口控制按钮（俗称“红绿灯”）</p>
</blockquote>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: true, height:&#x27;100px&#x27; &#125;</span></span><br><span class="line"><span class="comment">// 创建一个无边框的窗口</span></span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> win = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">titleBarStyle</span>: <span class="string">&#x27;hidden&#x27;</span> &#125;)</span><br><span class="line">win.loadURL(<span class="string">&#x27;https://github.com&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>效果如下：<br><img src= "/img/loading.gif" data-lazy-src="http://mei160.cn/images/window-type-frame.gif" alt="window-type-frame"></p>
<ul>
<li>配置<code>titleBarStyle: &#39;hiddenInset&#39;</code><blockquote>
<p>返回一个另一种隐藏了标题栏的窗口，其中控制按钮到窗口边框的距离更大。</p>
</blockquote>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: true, height:&#x27;100px&#x27; &#125;</span></span><br><span class="line"><span class="comment">// 创建一个无边框的窗口</span></span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> win = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">titleBarStyle</span>: <span class="string">&#x27;hiddenInset&#x27;</span> &#125;)</span><br><span class="line">win.loadURL(<span class="string">&#x27;https://github.com&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>效果如下：<br><img src= "/img/loading.gif" data-lazy-src="http://mei160.cn/images/window-type-frame2.gif" alt="window-type-frame2"></p>
<h5 id="1-1-0-3-3-配置titleBarStyle-39-customButtonsOnHover-39"><a href="#1-1-0-3-3-配置titleBarStyle-39-customButtonsOnHover-39" class="headerlink" title="1.1.0.3.3. 配置titleBarStyle: &#39;customButtonsOnHover&#39;"></a>1.1.0.3.3. 配置<code>titleBarStyle: &#39;customButtonsOnHover&#39;</code></h5><p>效果如下：<br><img src= "/img/loading.gif" data-lazy-src="http://mei160.cn/images/window-type-frame3.gif" alt="window-type-frame2"></p>
<h4 id="无边框窗口常见的问题"><a href="#无边框窗口常见的问题" class="headerlink" title="无边框窗口常见的问题"></a>无边框窗口常见的问题</h4><ul>
<li>窗口顶部无法拖拽的问题<br>默认情况下, 无边框窗口是不可拖拽的。 应用程序需要在 <code>CSS</code> 中指定 <code>-webkit-app-region: drag</code> 来告诉 <code>Electron</code> 哪些区域是可拖拽的（如操作系统的标准标题栏），在可拖拽区域内部使用 <code>-webkit-app-region: no-drag</code> 则可以将其中部分区域排除。 请注意, 当前只支持矩形形状。<a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/frameless-window#%E5%8F%AF%E6%8B%96%E6%8B%BD%E5%8C%BA">完整文档</a></li>
</ul>
<p>使用<code>-webkit-app-region: drag</code> 来实现拖拽，但是会导致内部的<code>click</code>事件失效。这个时候可以将需要<code>click</code>元素设置为<code>-webkit-app-region: no-drag</code>。具体的细节可看<a target="_blank" rel="noopener" href="https://github.com/electron/electron/issues/3647">issues</a></p>
<p>为了不影响窗口，这里拖拽的代码，应该在<code>preload</code>触发。<br>核心代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在顶部插入一个可以移动的dom</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initTopDrag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> topDiv = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>) <span class="comment">// 创建节点</span></span><br><span class="line">  topDiv.style.position = <span class="string">&#x27;fixed&#x27;</span> <span class="comment">// 一直在顶部</span></span><br><span class="line">  topDiv.style.top = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">  topDiv.style.left = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">  topDiv.style.height = <span class="string">&#x27;20px&#x27;</span> <span class="comment">// 顶部20px才可拖动</span></span><br><span class="line">  topDiv.style.width = <span class="string">&#x27;100%&#x27;</span> <span class="comment">// 宽度100%</span></span><br><span class="line">  topDiv.style.zIndex = <span class="string">&#x27;9999&#x27;</span> <span class="comment">// 悬浮于最外层</span></span><br><span class="line">  topDiv.style.pointerEvents = <span class="string">&#x27;none&#x27;</span> <span class="comment">// 用于点击穿透</span></span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  topDiv.style[<span class="string">&#x27;-webkit-user-select&#x27;</span>] = <span class="string">&#x27;none&#x27;</span> <span class="comment">// 禁止选择文字</span></span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  topDiv.style[<span class="string">&#x27;-webkit-app-region&#x27;</span>] = <span class="string">&#x27;drag&#x27;</span> <span class="comment">// 拖动</span></span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(topDiv) <span class="comment">// 添加节点</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="function"><span class="keyword">function</span> <span class="title">onDOMContentLoaded</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    initTopDrag()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>试一试</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: true, height:&#x27;200px&#x27; &#125;</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> BaseWebPreferences = &#123;</span><br><span class="line">  nodeIntegration: <span class="literal">true</span>,</span><br><span class="line">  preload: path.resolve(__dirname, <span class="string">&#x27;./windowType.js&#x27;</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主窗口代码</span></span><br><span class="line"><span class="keyword">const</span> win = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">webPreferences</span>: BaseWebPreferences, <span class="attr">frame</span>: <span class="literal">false</span> &#125;)</span><br><span class="line">win.loadURL(<span class="string">&#x27;https://github.com&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="父子窗口"><a href="#父子窗口" class="headerlink" title="父子窗口"></a>父子窗口</h3><p>子窗口始终在父窗口之上，在 <strong>窗口之间通信</strong> 章节中介绍到父子窗口之间的通信，<a href="./index.html#/browser/communication"><strong>窗口之间通信</strong></a>章节</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @@code-renderer: runner</span></span><br><span class="line"><span class="comment">// @@code-props: &#123; hideRight: true, height:&#x27;100px&#x27; &#125;</span></span><br><span class="line"><span class="keyword">const</span> &#123; BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> top = <span class="keyword">new</span> BrowserWindow()</span><br><span class="line"><span class="keyword">let</span> child = <span class="keyword">new</span> BrowserWindow(&#123; <span class="attr">parent</span>: top &#125;)</span><br><span class="line">child.show()</span><br><span class="line">top.show()</span><br></pre></td></tr></table></figure>

<h3 id="模态窗口"><a href="#模态窗口" class="headerlink" title="模态窗口"></a>模态窗口</h3></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">王美</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://hard-workingrookie.github.io/2021/01/07/electron%E7%AA%97%E5%8F%A3%E7%AE%A1%E7%90%86/">https://hard-workingrookie.github.io/2021/01/07/electron%E7%AA%97%E5%8F%A3%E7%AE%A1%E7%90%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://hard-workingrookie.github.io" target="_blank">王美的个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/electron/">electron</a></div><div class="post_share"><div class="social-share" data-image="http://tvshow.date/images/1504170750981724.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="/img/wechat.jpg"/></a><div class="post-qr-code-desc"></div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="/img/alipay.jpg"/></a><div class="post-qr-code-desc"></div></li></ul></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/03/09/DevOps%E6%80%BB%E7%BB%93/"><img class="prev-cover" data-lazy-src="http://tvshow.date/images/1391569032.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">DevOps总结</div></div></a></div><div class="next-post pull-right"><a href="/2021/01/07/electron%E5%BA%94%E7%94%A8/"><img class="next-cover" data-lazy-src="http://tvshow.date/images/1504170750981724.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">electron应用</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2021/01/07/electron应用/" title="electron应用"><img class="relatedPosts_cover" data-lazy-src="http://tvshow.date/images/1504170750981724.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-07</div><div class="relatedPosts_title">electron应用</div></div></a></div><div class="relatedPosts_item"><a href="/2021/01/07/electron工程化/" title="electron工程化"><img class="relatedPosts_cover" data-lazy-src="http://tvshow.date/images/1504170750981724.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-07</div><div class="relatedPosts_title">electron工程化</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer" style="background-image: url(http://tvshow.date/images/1504170750981724.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By 王美</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi,  welcome  to  my  <a  href="https://hard-workingrookie.github.io/">blog</a>!</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    window.valine = new Valine({
      el: '#vcomment',
      appId: '',
      appKey: '',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    });
    if ('nick,mail') { valine.config.requiredFields= 'nick,mail'.split(',') }
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/js/third-party/click_heart.js" async="async"></script></div></body></html>